#Loading the packages
```{r load_packages}
library(tidyverse)
library(readr)
library(readxl)
library(reactable)
library(scales)
```

```{r importing_xl}
Unemployment_dataset <- read_excel("dataset/Unemployment.xlsx", range = "A5:CN3201")
Education_dataset <- read_excel("dataset/Education.xlsx", range = "A5:AU3209")
Population_dataset <- read_excel("dataset/PopulationEstimates.xlsx", range = "A2:H3203")
Poverty_dataset <- read_excel("dataset/PovertyEstimates.xls", range = "A5:AB3198")
```

<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
#Sorting it out using data summary techniques

```{r reactable_code}
reactable(Unemployment_dataset, sortable = FALSE, showPageSizeOptions = TRUE, 
    onClick = "expand")
```
#Making the change for you
=======
#Tidying the tables
>>>>>>> 15bb89b599258dc665d595d285853892713b39b0

```{r tidy_tables}
income_table <- Unemployment_dataset %>%
  select("FIPS_Code","Area_name","Median_Household_Income_2019")

edu_table <- Education_dataset %>%
  select(c(1),c(3),c(44:47))%>%
  rename("FIPS_Code" = c(1), "Area_name" = c(2), "Percent_No_Diploma" = c(3), "Percent_Diploma" = c(4), "Percent_Associates" = c(5),"Percent_Bachelors" = c(6))

popn_table <- Population_dataset%>%
  select(-c(2),-c(6:7))%>%
  rename("FIPS_Code" = c(1),"Area_name" = c(2),"Rural_urban_code" = c(3),"Start_popn" = c(4), "End_popn" = c(5))%>%
  mutate(avg_decade_growth_rate = ((1+((End_popn-Start_popn)/Start_popn))^(1/3)-1))

pov_table <- Poverty_dataset%>%
  select(c(1),c(3),c(11))%>%
  rename("FIPS_Code" = c(1),"Percent_Poverty" = c(3))

```

#Merged Tables

```{r merged_tables}
inc_edu_state <- merge(x = income_table, y = edu_table, by = "FIPS_Code")%>%
  select(-c(4))%>%
  filter(endsWith(FIPS_Code,"000"))

inc_edu_county <- merge(x = income_table, y = edu_table, by = "FIPS_Code")%>%
  select(-c(4))%>%
  filter(!endsWith(FIPS_Code,"000"))
```

Full Tables:

```{r join_county_tables}
full_county_table <- Reduce(function(...) merge(..., all = TRUE, by = "FIPS_Code"),
  list(income_table, edu_table, popn_table, pov_table))%>%
  select(-c(4),-c(9),-c(14))%>%
  filter(!endsWith(FIPS_Code,"000"))%>%
  drop_na()

full_state_table <- Reduce(function(...) merge(..., all = TRUE, by = "FIPS_Code"),
  list(income_table, edu_table, popn_table, pov_table))%>%
  select(-c(4),-c(9),-c(14))%>%
  filter(endsWith(FIPS_Code,"000"))%>%
  select(-c(8))

```

  
County Table Grouped By Urban Classification

```{r group_by_urb}
bach_urban_class <- full_county_table %>%
group_by(Rural_urban_code)%>%
  summarise_at(vars(Percent_Bachelors),funs(mean(Percent_Bachelors)))

no_diploma_urban_class <- full_county_table %>%
group_by(Rural_urban_code)%>%
  summarise_at(vars(Percent_No_Diploma),funs(mean(Percent_No_Diploma)))

diploma_urban_class <- full_county_table %>%
group_by(Rural_urban_code)%>%
  summarise_at(vars(Percent_Diploma),funs(mean(Percent_Diploma)))

assoc_urban_class <- full_county_table %>%
group_by(Rural_urban_code)%>%
  summarise_at(vars(Percent_Associates),funs(mean(Percent_Associates)))

```

```{r full_group_by_urb}
group_by_urb_table <- Reduce(function(...) merge(..., all = TRUE, by = "Rural_urban_code"),
  list(bach_urban_class, no_diploma_urban_class, diploma_urban_class, assoc_urban_class))
```

```{r geom_smooth}
ggplot(full_county_table, aes(Median_Household_Income_2019, Percent_Bachelors, colour=Rural_urban_code, group = Rural_urban_code))+
  geom_smooth(se = FALSE)
```
Income:
We found that more urban areas had a greater correlation between income and
percentage of people receiving a bachelors degree. In more rural areas, the percentage of people with a bachelors degree eventually levels out as income increases. Surprisingly, education levels in counties with a 9 on the rural-urban continuum code actually start to decline when income reaches around $70,000. Counties with a 10 on the scale have an almost perfectly linear relationship between income and education.

#Graphs

```{r Statewise Cleaning}
library (usmap)
St_Pop <- inc_edu_state[order(inc_edu_state$Area_name),]
St_Pop <- St_Pop[!(St_Pop$Area_name == "United States"),]
St_Pop$fips <- statepop$fips 
St_Pop$abbr <- statepop$abbr

St_Pop <- St_Pop %>% 
  rename(Income = Median_Household_Income_2019) %>% 
  rename(Less_than_High_School = `Percent_No_Diploma`) %>% 
  rename ( High_School_Only = `Percent_Diploma`) %>% 
  rename(College_or_Associate = `Percent_Associates`) %>% 
  rename(Bachelors = `Percent_Bachelors`)

```

```{r Countywise Cleaning}
#anti_join(countypop, Ct_Pop, by = "fips")
Ct_Pop <- inc_edu_county[order(inc_edu_county$Area_name),]
Ct_Pop <- Ct_Pop[order(Ct_Pop$FIPS_Code),]
Ct_Pop <- na.omit(Ct_Pop)
temp1 <- countypop
temp2 <- temp1[!(temp1$fips == "15005"),]
Ct_Pop$fips <- temp2$fips
Ct_Pop$abbr <- temp2$abbr
Ct_Pop <- Ct_Pop %>% 
  rename(Income = Median_Household_Income_2019) %>% 
  rename(Less_than_High_School = `Percent_No_Diploma`) %>% 
  rename ( High_School_Only = `Percent_Diploma`) %>% 
  rename(College_or_Associate = `Percent_Associates`) %>% 
  rename(Bachelors = `Percent_Bachelors`)

```


